import{a as e,b as r,c as t,d as n}from"./chunk-350af72f.js";import{a}from"./chunk-96639b88.js";import s from"ethereumjs-tx";import c from"ethereumjs-wallet/hdkey";import{sha3 as o,toDecimal as i,toHex as u}from"web3-utils";import{e as p}from"./chunk-b4810d43.js";import{a as h}from"./chunk-25f6a05b.js";import f from"trezor-connect";import{a as d}from"./chunk-ade9ee03.js";export default(function(){function l(){n(this,l)}return e(l,null,[{key:"getNextWallets",value:function(){var e=r(t.mark(function e(r){var n,a,s,o,i,u,p,f;return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.offset,a=void 0===n?0:n,s=r.limit,o=void 0===s?10:s,i=r.xpub,e.prev=1,e.t0=i,e.t0){e.next=7;break}return e.next=6,l.getPublicExtendedKey();case 6:e.t0=e.sent;case 7:return u=e.t0,p=c.fromExtendedKey(u),f=d(p,a,o),e.abrupt("return",{addresses:f,xpub:u});case 13:throw e.prev=13,e.t1=e.catch(1),new h({title:"Access error",text:"An error occurred while getting access to hardware device. Please, try again.",type:"is-danger"});case 16:case"end":return e.stop()}},e,this,[[1,13]])}));return function(r){return e.apply(this,arguments)}}()},{key:"getPublicExtendedKey",value:function(){var e=r(t.mark(function e(){var r,n,a;return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=ENV.hdKeyMnemonic.path,e.next=4,f.getPublicKey({path:r});case 4:return n=e.sent,a=n.payload.xpub,e.abrupt("return",a);case 9:throw e.prev=9,e.t0=e.catch(0),new h({title:"Access error",text:"An error occurred while getting access to hardware device. Please, try again.",type:"is-danger"});case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=r(t.mark(function e(r,n){var a,s,c,h,d,l,m,v,x,g;return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="Ethereum Signed Message:\n".concat(r.length).concat(r),s=o(a),e.next=4,f.ethereumSignMessage({path:"".concat(p).concat(n),message:r});case 4:if(c=e.sent,h=c.success,d=c.payload,h){e.next=9;break}throw new Error(d.error||"Bad Trezor response");case 9:return l=d.signature,m="0x".concat(l.slice(0,64)),v="0x".concat(l.slice(64,128)),x=i(l.slice(128,130)),g=u(27===x||28===x?x:x+27),e.abrupt("return",{message:r,messageHash:s,signature:"0x".concat(l),r:m,s:v,v:g});case 15:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var e=r(t.mark(function e(r,n){var c,o,i,u;return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.ethereumSignTransaction({path:"".concat(p).concat(n),transaction:r});case 2:if(c=e.sent,!(o=c.payload).error){e.next=6;break}throw new Error(o.error||"Bad Trezor response");case 6:return i={r:o.r,s:o.s,v:o.v},u=new s(a({},r,i)),e.abrupt("return","0x".concat(u.serialize().toString("hex")));case 9:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()}]),l}());
