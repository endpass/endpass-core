import{b as t,c as e,a as r,d as n}from"./chunk-350af72f.js";import{a}from"./chunk-96639b88.js";import{c as u}from"./chunk-9a880e46.js";import i from"path-to-regexp";import o from"dexie";var c=function(t,e){return Object.keys(t).find(function(r){return t[r].test(e)})},s=function(t,e){var r=e.split(t).pop()||"";return"/"===r[0]?r.substring(1):r},d=function(t,e,r){var n=i.parse(e),a=t[e];a.lastIndex=0;var u=a.exec(r);return n.reduce(function(t,e,r){return e&&e.name&&(t[e.name]=u[r]),t},{})},f={getItemData:function(t){return t.map(function(t){return t.data})},itemsRead:function(t){return t.toArray(function(t){return f.getItemData(t)})},itemRead:function(t,e){return new Promise(function(r,n){t.where(e).first(function(t){return t&&t.data?r(t.data):n("Data is empty")}).catch(n)})},itemRemove:function(t,e){return t.where(e).delete()},itemWrite:function(t,e,r){return t.put({id:e,data:r})},itemAdd:function(){var r=t(e.mark(function t(r,n,u){var i,o,c;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={},t.prev=1,t.next=4,f.itemRead(r,{id:n});case 4:o=t.sent,Object.assign(i,o||{}),t.next=10;break;case 8:t.prev=8,t.t0=t.catch(1);case 10:return c={id:n,data:a({},i,u)},t.abrupt("return",r.put(c));case 12:case"end":return t.stop()}},t,this,[[1,8]])}));return function(t,e,n){return r.apply(this,arguments)}}()};function p(t,e){var r=t.id;return"function"==typeof r?r(e):e[r]}var l={read:function(t,e){if(!t.id)return f.itemsRead(t.table);var r=p(t,e);return f.itemRead(t.table,{id:r})},add:function(t,e,r){var n=p(t,e);return f.itemAdd(t.table,n,r.payload)},write:function(t,e,r){var n=p(t,e);return f.itemWrite(t.table,n,r.payload)},remove:function(t,e,r){var n=p(t,e);return f.itemRemove(t.table,{id:n},r.payload)}},m=new o("LocalProvider");function v(t){return t.split("/")[0]}m.version(1.1).stores({accounts:"id,data",accountsInfo:"id,data",settings:"id,data",tokens:"id,data",networks:"id,data"});var k={"account/:addressId/info":{table:m.accountsInfo,id:"addressId"},"account/:addressId":{table:m.accounts,id:"addressId"},"networks/:networkPath(.*)":{table:m.networks,id:"networkPath"},"tokens/:networkId":{table:m.tokens,read:function(t,e){return t.table.filter(function(t){return v(t.id)===e.networkId}).toArray(function(t){return f.getItemData(t)})}},"tokens/:networkId/:addressId":{table:m.tokens,id:function(t){return"".concat(t.networkId,"/").concat(t.addressId)}},accounts:{table:m.accounts,read:function(){var r=t(e.mark(function t(r){var n,a;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.itemsRead(r.table);case 2:return n=t.sent,a=n.map(function(t){return t.address}),t.abrupt("return",a);case 5:case"end":return t.stop()}},t,this)}));return function(t){return r.apply(this,arguments)}}()},settings:{table:m.settings,id:function(){return"userSettings"},init:function(){var r=t(e.mark(function t(r){var n,u,i;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={email:ENV.isProduction?"":"default@email.com",otp_enabled:!1},t.prev=1,t.next=4,l.read(r);case 4:u=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),u={};case 10:return(i=a({},n,u)).email||(i.email=n.email),t.abrupt("return",l.add(r,{},{payload:i}));case 13:case"end":return t.stop()}},t,this,[[1,7]])}));return function(t){return r.apply(this,arguments)}}(),read:function(){var r=t(e.mark(function t(r,n){var i,o,c,s,d;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([m.tokens.toArray(function(t){return t.reduce(function(t,e){var r=v(e.id);return(t[r]=t[r]||[]).push(e.data),t},{})}),m.networks.toArray(function(t){return f.getItemData(t)}),l.read(r,n)]);case 2:return i=t.sent,o=u(i,3),c=o[0],s=o[1],d=o[2],t.abrupt("return",a({tokens:c,networks:s},d));case 8:case"end":return t.stop()}},t,this)}));return function(t,e){return r.apply(this,arguments)}}()},"settings/otp":{table:m.settings,id:function(){return"otp"}}},b=Object.keys(k).reduce(function(t,e){return t[e]=i(e),t},{});export default(function(){function a(t){n(this,a),this.serverUrl=t}return r(a,[{key:"initRoutes",value:function(){var r=t(e.mark(function t(){var r;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.keys(k).filter(function(t){return!!k[t].init}),t.next=3,Promise.all(r.map(function(t){var e=k[t];return e.init(e)}));case 3:case"end":return t.stop()}},t,this)}));return function(){return r.apply(this,arguments)}}()},{key:"request",value:function(){var r=t(e.mark(function t(r){var n,a,u,i,o,f,p;return e.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.url,"clear"!==(a=r.method)){t.next=3;break}return t.abrupt("return",this.clear());case 3:if(u=s(this.serverUrl,n),i=c(b,u)){t.next=7;break}throw new Error("not defined route key in ".concat(u));case 7:return o=k[i],f=d(b,i,u),p=o[a]||l[a],t.abrupt("return",p(o,f,r));case 11:case"end":return t.stop()}},t,this)}));return function(t){return r.apply(this,arguments)}}()},{key:"clear",value:function(){var t={},e=Object.keys(k).filter(function(e){var r=k[e].table,n=!t[r.name];return t[r.name]=!0,n}).map(function(t){return k[t].table});return Promise.all(e.map(function(t){return t.clear()}))}}]),a}());
