import{a as e,b as t,c as r,d as n}from"./chunk-350af72f.js";import{a}from"./chunk-96639b88.js";import c from"ethereumjs-tx";import s from"ethereumjs-wallet/hdkey";import{sha3 as o,toHex as i}from"web3-utils";import{e as u}from"./chunk-b4810d43.js";import{a as h}from"./chunk-25f6a05b.js";import{a as l}from"./chunk-ade9ee03.js";import p from"@ledgerhq/hw-transport-u2f";import f from"@ledgerhq/hw-app-eth";export default(function(){function g(){n(this,g)}return e(g,null,[{key:"getNextWallets",value:function(){var e=t(r.mark(function e(t){var n,a,c,o,i,u,p,f;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.offset,a=void 0===n?0:n,c=t.limit,o=void 0===c?10:c,i=t.xpub,e.prev=1,e.t0=i,e.t0){e.next=7;break}return e.next=6,g.getPublicExtendedKey();case 6:e.t0=e.sent;case 7:return u=e.t0,p=s.fromExtendedKey(u),f=l(p,a,o),e.abrupt("return",{addresses:f,xpub:u});case 13:if(e.prev=13,e.t1=e.catch(1),!(e.t1 instanceof h)){e.next=17;break}throw e.t1;case 17:throw new h({title:"Access error",text:"An error occurred while getting access to hardware device. Please, try again.",type:"is-danger"});case 18:case"end":return e.stop()}},e,this,[[1,13]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getPublicExtendedKey",value:function(){var e=t(r.mark(function e(){var t,n,a,c,s;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.create();case 3:return t=e.sent,n=new f(t),e.next=7,n.getAddress(ENV.hdKeyMnemonic.path);case 7:return a=e.sent,c=a.publicKey,e.abrupt("return",c);case 12:throw e.prev=12,e.t0=e.catch(0),console.log(e.t0),s="An error occurred while getting access to hardware device. Please, try again.",e.t0.message.includes("U2F")&&(s=e.t0.message),new h({title:"Access error",text:s,type:"is-danger"});case 18:if(e.prev=18,!t||!t.close){e.next=22;break}return e.next=22,t.close().catch(console.log);case 22:return e.finish(18);case 23:case"end":return e.stop()}},e,this,[[0,12,18,23]])}));return function(){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=t(r.mark(function e(t,n){var a,c,s,l,g,d,x,v,w,m,y;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.create();case 3:return a=e.sent,c=new f(a),s="Ethereum Signed Message:\n".concat(t.length).concat(t),l=o(s),e.next=9,c.signPersonalMessage("".concat(u).concat(n),Buffer.from(t).toString("hex"));case 9:return g=e.sent,d=g.r,x=g.s,v=g.v,(w=(v-27).toString(16)).length<2&&(w="0".concat(w)),m=i(27===w||28===w?v:v+27),y="0x".concat(d).concat(x).concat(w),e.abrupt("return",{message:t,messageHash:l,signature:y,r:"0x".concat(d),s:"0x".concat(x),v:"0x".concat(m)});case 20:throw e.prev=20,e.t0=e.catch(0),console.log(e.t0),new h({title:"Access error",text:"An error occurred while getting access to hardware device. Please, try again.",type:"is-danger"});case 24:if(e.prev=24,!a||!a.close){e.next=28;break}return e.next=28,a.close().catch(console.log);case 28:return e.finish(24);case 29:case"end":return e.stop()}},e,this,[[0,20,24,29]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var e=t(r.mark(function e(t,n){var s,o,i,l,g,d;return r.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.create();case 3:return s=e.sent,o=new f(s),i=new c(t),e.next=8,o.signTransaction("".concat(u).concat(n),"".concat(i.serialize().toString("hex")));case 8:if(l=e.sent){e.next=11;break}throw new Error("Bad Trezor response");case 11:return g={r:l.r,s:l.s,v:l.v},d=new c(a({},t,g)),e.abrupt("return","0x".concat(d.serialize().toString("hex")));case 16:throw e.prev=16,e.t0=e.catch(0),console.log(e.t0),new h({title:"Access error",text:"An error occurred while getting access to hardware device. Please, try again.",type:"is-danger"});case 20:if(e.prev=20,!s||!s.close){e.next=24;break}return e.next=24,s.close().catch(console.log);case 24:return e.finish(20);case 25:case"end":return e.stop()}},e,this,[[0,16,20,25]])}));return function(t,r){return e.apply(this,arguments)}}()}]),g}());
